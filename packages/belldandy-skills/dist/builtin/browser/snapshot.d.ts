/**
 * 注入到页面的快照生成脚本
 * 注意：由于这是要注入到浏览器环境中执行的代码，不能引用外部依赖（除非打包进去），这里尽量保持纯 JS
 */
export declare const SNAPSHOT_SCRIPT = "\n(function() {\n    const ID_ATTR = 'data-agent-id';\n    let idCounter = 1;\n    const elementMap = new Map(); // id -> element (client side only)\n    \n    // \u914D\u7F6E\uFF1A\u54EA\u4E9B\u6807\u7B7E\u88AB\u8BA4\u4E3A\u662F\"\u5BB9\u5668\"\uFF0C\u54EA\u4E9B\u662F\"\u5185\u5BB9\"\n    const INTERACTIVE_TAGS = new Set(['BUTTON', 'A', 'INPUT', 'TEXTAREA', 'SELECT', 'LABEL']);\n    const CONTENT_TAGS = new Set(['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'LI', 'SPAN', 'DIV', 'TD', 'TH']);\n    const SKIPPED_TAGS = new Set(['SCRIPT', 'STYLE', 'svg', 'NOSCRIPT', 'IFRAME', 'LINK', 'META', 'HEAD']);\n\n    function isVisible(el) {\n        if (!el.getBoundingClientRect) return false;\n        const rect = el.getBoundingClientRect();\n        if (rect.width === 0 || rect.height === 0) return false;\n        const style = window.getComputedStyle(el);\n        return style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0';\n    }\n\n    function isInteractive(el) {\n        if (INTERACTIVE_TAGS.has(el.tagName)) return true;\n        if (el.getAttribute('role') === 'button' || el.getAttribute('role') === 'link') return true;\n        if (el.getAttribute('onclick') || el.onclick) return true; // Simple heuristic\n        // Check for inputs\n        if (el.tagName === 'INPUT' && el.type !== 'hidden') return true;\n        return false;\n    }\n\n    function cleanupText(text) {\n        return text ? text.replace(/\\s+/g, ' ').trim() : '';\n    }\n\n    function traverse(node, depth = 0) {\n        if (!node) return '';\n        if (node.nodeType === Node.TEXT_NODE) {\n            const text = cleanupText(node.textContent);\n            return text.length > 0 ? text : '';\n        }\n\n        if (node.nodeType !== Node.ELEMENT_NODE) return '';\n        const el = node;\n\n        if (SKIPPED_TAGS.has(el.tagName) || !isVisible(el)) return '';\n\n        const interactive = isInteractive(el);\n        let output = '';\n\n        // \u5206\u914D ID (\u53EA\u7ED9\u4EA4\u4E92\u5143\u7D20\u6216\u91CD\u8981\u8282\u70B9)\n        let idStr = '';\n        if (interactive) {\n            const id = idCounter++;\n            el.setAttribute(ID_ATTR, id);\n            idStr = `[${id}] `;\n        }\n\n        // \u5904\u7406\u5B50\u8282\u70B9\n        let childrenOutput = '';\n        for (const child of el.childNodes) {\n            const childResult = traverse(child, depth + 1);\n            if (childResult) {\n                childrenOutput += (childrenOutput ? ' ' : '') + childResult;\n            }\n        }\n        \n        // \u53EA\u6709\u5F53\u672C\u8EAB\u662F\u4EA4\u4E92\u5143\u7D20\uFF0C\u6216\u8005\u5305\u542B\u6709\u610F\u4E49\u7684\u6587\u672C/\u5B50\u5143\u7D20\u65F6\uFF0C\u624D\u4EA7\u751F\u8F93\u51FA\n        // \u5426\u5219\u5982\u679C\u53EA\u662F\u4E2A\u7EAF\u5BB9\u5668\u4E14\u5185\u5BB9\u4E3A\u7A7A\uFF0C\u5C31\u5FFD\u7565\n        const hasContent = childrenOutput.length > 0;\n        \n        if (interactive) {\n            // \u4EA4\u4E92\u5143\u7D20\uFF1A[ID] <Tag Attributes>Content</Tag>\n            // \u7B80\u5316\u5C5E\u6027\n            let attrs = '';\n            if (el.tagName === 'INPUT') {\n                attrs += ` type=\"${el.type}\"`;\n                if (el.placeholder) attrs += ` placeholder=\"${el.placeholder}\"`;\n                if (el.value) attrs += ` value=\"${el.value}\"`;\n            }\n            if (el.tagName === 'A' && el.href) {\n                // \u4EC5\u4E3A\u4E86\u63D0\u793A\uFF0C\u4E0D\u4E00\u5B9A\u8981\u5B8C\u6574 URL\n                // attrs += ` href=\"${el.href}\"`; \n                attrs += ' (link)';\n            }\n            \n            output = `${idStr}<${el.tagName.toLowerCase()}${attrs}>${childrenOutput}</${el.tagName.toLowerCase()}>`;\n        } else if (CONTENT_TAGS.has(el.tagName) && hasContent) {\n            // \u5185\u5BB9\u5143\u7D20\uFF1A\u4FDD\u7559\u6807\u7B7E\u7ED3\u6784\u4EE5\u4FBF\u7406\u89E3\u5C42\u7EA7\uFF0C\u6216\u8005\u5BF9\u4E8E div/span \u53EA\u4FDD\u7559\u5185\u5BB9\n            const isStructural = ['H1','H2','H3','H4','H5','H6','P','LI'].includes(el.tagName);\n            if (isStructural) {\n                output = `<${el.tagName.toLowerCase()}>${childrenOutput}</${el.tagName.toLowerCase()}>`;\n            } else {\n                // div / span / td -> \u53EA\u8F93\u51FA\u5185\u5BB9\uFF0C\u9664\u975E\u6709\u7279\u6B8A role\n                output = childrenOutput; \n            }\n        } else {\n            // \u5176\u4ED6\u5BB9\u5668 -> \u53EA\u900F\u4F20\u5185\u5BB9\n            output = childrenOutput;\n        }\n\n        return output;\n    }\n\n    // \u6E05\u7406\u4E4B\u524D\u7684 ID\n    document.querySelectorAll(`[${ID_ATTR}]`).forEach(el => el.removeAttribute(ID_ATTR));\n    \n    // \u751F\u6210\u5FEB\u7167\n    const snapshot = traverse(document.body);\n    \n    // \u683C\u5F0F\u5316\u8F93\u51FA\uFF1A\u5C1D\u8BD5\u7B80\u5355\u7684\u7F29\u8FDB\u6216\u5206\u884C\u4F18\u5316\uFF08\u8FD9\u91CC\u5148\u8FD4\u56DE\u5E73\u94FA\u6587\u672C\uFF0C\u6216\u8005\u6309 block \u5143\u7D20\u5206\u884C\uFF09\n    // \u4E3A\u4E86\u66F4\u9002\u5408 LLM\uFF0C\u6211\u4EEC\u518D\u505A\u4E00\u6B21\u540E\u5904\u7406\uFF0C\u628A block \u6807\u7B7E\u6362\u884C\n    return snapshot\n        .replace(/<\\/(h[1-6]|p|li|div)>/gi, '$&\\n') // block \u6807\u7B7E\u540E\u6362\u884C\n        .replace(/>\\s+</g, '> <') // \u6807\u7B7E\u95F4\u4FDD\u7559\u4E00\u4E2A\u7A7A\u683C\n        .split('\\n').map(line => line.trim()).filter(line => line.length > 0).join('\\n');\n\n})();\n";
//# sourceMappingURL=snapshot.d.ts.map