# ============================================
# Belldandy 环境变量配置模板
# 复制此文件为 .env.local 并填写实际值
# ============================================

# ------ 服务配置 ------
# Gateway 服务端口（默认 28889）
BELLDANDY_PORT=28889

# 绑定地址（默认 127.0.0.1，设置为 0.0.0.0 可局域网访问）
# BELLDANDY_HOST=127.0.0.1

# 状态目录（配对、记忆、人格文件存放路径；同时是 file_read/file_write/file_delete 的工作区根目录，默认 ~/.belldandy）
BELLDANDY_STATE_DIR=C:\Users\admin\.belldandy
# 额外允许 Agent 读写的根目录，逗号分隔（如其他盘符下的目录），不设则仅限上面状态目录
BELLDANDY_EXTRA_WORKSPACE_ROOTS="C:\Users\admin\Pictures,E:\"

# ------ 鉴权配置 ------
# 鉴权模式: none | token | password（默认 none）
# 注意：即使是 none，新设备连接也需要 Pairing 配对
BELLDANDY_AUTH_MODE=none
# 当 AUTH_MODE=token 时必填
# BELLDANDY_AUTH_TOKEN=your-secret-token
# 当 AUTH_MODE=password 时必填
# BELLDANDY_AUTH_PASSWORD=your-password

# WebSocket Origin 白名单（逗号分隔，防 CSWSH 攻击）
# 作用：限制哪些网页/客户端可以连接到 Belldandy Gateway
# 默认行为：若不设置，本地开发环境（HOST=127.0.0.1）自动允许 localhost/127.0.0.1
BELLDANDY_ALLOWED_ORIGINS=http://127.0.0.1:28889
# 配置建议：
# - 纯本地使用（命令行）：不需要配置
# - 本地 Web 开发：BELLDANDY_ALLOWED_ORIGINS=http://localhost:5173
# - 公网部署/生产环境：BELLDANDY_ALLOWED_ORIGINS=https://console.belldandy.ai
# BELLDANDY_ALLOWED_ORIGINS=http://localhost:3000,https://app.example.com
# 多个地址用英文逗号 , 分隔

# 流式输出（默认 true）
BELLDANDY_OPENAI_STREAM=true
# 单次模型调用超时（毫秒，默认 120000 即 2 分钟）
BELLDANDY_AGENT_TIMEOUT_MS=300000

# ------ 工具与能力 ------
# 启用工具调用（联网、读写文件等）
BELLDANDY_TOOLS_ENABLED=true

# 工具分组加载（默认 all 加载全部，逗号分隔可选组）
# 可选组：browser（浏览器自动化）, multimedia（摄像头/图片生成/TTS）, methodology（方法论SOP）, system（日志/定时任务/重启/模组切换）
# core 组（file/fetch/memory/apply_patch）始终加载，无需指定
# 使用中转代理时建议只加载需要的组以减少 token 消耗
# 示例：BELLDANDY_TOOL_GROUPS=core（只加载核心工具）
# 示例：BELLDANDY_TOOL_GROUPS=browser,system（加载核心+浏览器+系统工具）
BELLDANDY_TOOL_GROUPS=all

# 最大输入 token 数限制（超过时自动裁剪历史消息，0 或不设表示不限制）
# 使用有输入长度限制的中转代理时建议设置，如 BELLDANDY_MAX_INPUT_TOKENS=20000
BELLDANDY_MAX_INPUT_TOKENS=120000

# 启用危险工具（run_command 等，默认 false）
# ⚠️ 仅在受信任环境下启用，允许执行任意命令
# 注：启用后命令执行仍受下方 TOOLS_POLICY_FILE 中 exec 规则约束（超时、白名单等）
BELLDANDY_DANGEROUS_TOOLS_ENABLED=true

# 工具策略配置文件（JSON），用于覆盖默认的工具策略
# 示例：E:\\project\\belldandy\\config\\tools-policy.json
BELLDANDY_TOOLS_POLICY_FILE=E:\\project\\belldandy\\config\\tools-policy.json
# 示例内容（JSON）：
# {
#   "allowedPaths": ["workspace", "notes"],
#   "deniedPaths": [".git", "node_modules", ".env"],
#   "exec": {
#     "quickTimeoutMs": 5000,
#     "longTimeoutMs": 300000,
#     "extraSafelist": ["terraform", "docker", "podman", "kubectl", "helm"],
#     "extraBlocklist": [],
#     "nonInteractive": {
#       "enabled": true,
#       "rules": {
#         "npm init": "-y",
#         "conda install": "-y"
#       }
#     }
#   }
# }

# ------ 记忆与向量检索 ------
# 启用向量搜索（需要 Embedding 模型）
# 模型会自动下载并保存到 ~/.belldandy/models 文件夹中
BELLDANDY_EMBEDDING_ENABLED=true
# Embedding 提供商选择: openai | local (默认是 openai)
# BELLDANDY_EMBEDDING_PROVIDER=openai
# 本地模型名称 (仅当 provider=local 时生效)
# 支持的模型: BAAI/bge-base-en-v1.5, BAAI/bge-small-en-v1.5 等
# 注意: fastembed npm 包暂不支持 bge-m3，请使用上述模型
# BELLDANDY_LOCAL_EMBEDDING_MODEL=BAAI/bge-base-en-v1.5
# 如果您的 Embedding 服务使用不同的 Key/BaseURL，请在此配置；否则默认使用上方的通用配置
# BELLDANDY_EMBEDDING_OPENAI_API_KEY="模型调用API_KEY"
# BELLDANDY_EMBEDDING_OPENAI_BASE_URL="模型调用地址"
# BELLDANDY_EMBEDDING_MODEL=text-embedding-ada-002

# Kimi K2.5 (Vision Support) 配置示例:
# BELLDANDY_OPENAI_BASE_URL="https://api.moonshot.cn/v1"
# BELLDANDY_OPENAI_API_KEY=sk-xxxxxxxx
# BELLDANDY_OPENAI_MODEL=kimi-k2.5-preview

# Embedding 批处理大小 (默认 2)
# 减小此值可避免 413 Payload Too Large 错误
BELLDANDY_EMBEDDING_BATCH_SIZE=2

# ------ 心跳定时任务 ------
# 启用心跳（Agent 定期检查 HEARTBEAT.md 并主动联系你）
BELLDANDY_HEARTBEAT_ENABLED=true
# 心跳间隔（支持 30m, 1h, 300s 格式）
BELLDANDY_HEARTBEAT_INTERVAL=30m
# 活跃时段（可选，深夜不打扰）
# BELLDANDY_HEARTBEAT_ACTIVE_HOURS=08:00-23:00

# ------ 浏览器自动化 ------
# 启用浏览器中继自动启动（需配合 Chrome 扩展）
BELLDANDY_BROWSER_RELAY_ENABLED=true
BELLDANDY_RELAY_PORT=28892

# 浏览器域名控制（双模式，类似 web_fetch）
# 白名单：设置后仅允许访问这些域名（不设则不限制）
# BELLDANDY_BROWSER_ALLOWED_DOMAINS=trusted.com,docs.example.com
# 黑名单：禁止访问的域名（永远生效，优先于白名单）
# BELLDANDY_BROWSER_DENIED_DOMAINS=malware.com,phishing-site.net

# ------ 定时任务 (Cron) ------
# 启用 Cron 调度引擎（Agent cron 工具始终可用，此开关仅控制自动调度）
BELLDANDY_CRON_ENABLED=true

# ------ MCP 支持 ------
# 启用 MCP 协议（需同时启用工具系统）
BELLDANDY_MCP_ENABLED=true

# ------ 模型容灾 (Model Failover) ------
# 备用模型配置文件路径（JSON 格式，默认 ~/.belldandy/models.json）
# 配置后，主模型限流/故障时自动切换到备用模型
BELLDANDY_MODEL_CONFIG_FILE=~/.belldandy/models.json

# ------ 日志系统 ------
# 最低日志级别 (debug/info/warn/error)
BELLDANDY_LOG_LEVEL=debug
# 日志目录，默认 ~/.belldandy/logs
BELLDANDY_LOG_DIR=~/.belldandy/logs
# 单文件最大大小，超过则轮转 (如 10MB)
BELLDANDY_LOG_MAX_SIZE=10MB
# 日志保留天数，超过自动清理
BELLDANDY_LOG_RETENTION_DAYS=7
# 是否输出到控制台 / 是否写入文件
BELLDANDY_LOG_CONSOLE=true
BELLDANDY_LOG_FILE=true

# ------ System Prompt 注入配置 ------
# 控制是否将 specific workspace files 注入到 System Prompt
# 如果禁用，Agent 将不会被告知这些信息（除非你在自定义 System Prompt 里写了）
# 注入 AGENTS.md (Workspace Guide)
BELLDANDY_INJECT_AGENTS="true"
# 注入 SOUL.md (Persona & Guidelines)
BELLDANDY_INJECT_SOUL="true"
# 注入 MEMORY.md (Core Memory & Notes)
BELLDANDY_INJECT_MEMORY="true"
# System Prompt 最大字符数限制（超过则按优先级自动截断低优先级段落，0 或不设表示不限制）
# 适用于对输入长度有限制的 API 代理（如 aicodewith），建议值 20000~40000
# 换算参考：纯英文约 4 字符 ≈ 1 token，中英混合约 3~4 字符 ≈ 1 token
# 例：20000 字符 ≈ 5000~6600 tokens，40000 字符 ≈ 10000~13000 tokens
# BELLDANDY_MAX_SYSTEM_PROMPT_CHARS=40000

# 传给模型的最近对话轮数（默认 50）
# 长期记忆已通过向量检索实现，此处仅需保留最近几轮维持对话连贯性
# 使用输入长度受限的 API 代理时建议设为 6~10
BELLDANDY_MAX_HISTORY=15

# ------ 对话压缩（Compaction） ------
# 是否启用上下文自动压缩（默认 true）
# 启用后，当历史消息 token 超过阈值时，自动将旧消息摘要化（三层渐进式压缩）
BELLDANDY_COMPACTION_ENABLED=true
# 当历史消息的估算 token 数超过此阈值时，自动将旧消息摘要化以减少 token 消耗
# 默认 12000（约 12K tokens），设为 0 或不设表示不启用压缩
# 建议anthropic模型设8000，OpenAI模型时设20000
BELLDANDY_COMPACTION_THRESHOLD=20000
# 压缩时保留最近几条消息原文（默认 10）
BELLDANDY_COMPACTION_KEEP_RECENT=10
# ReAct 循环内压缩触发比例（默认 0.75，即上下文窗口使用 75% 时触发循环内压缩）
# 需配合 BELLDANDY_MAX_INPUT_TOKENS 使用
BELLDANDY_COMPACTION_TRIGGER_FRACTION=0.8
# Rolling Summary 超过此 token 数时触发归档压缩（默认 2000）
BELLDANDY_COMPACTION_ARCHIVAL_THRESHOLD=4000
# 摘要专用模型（可选，不设则复用主模型）
# BELLDANDY_COMPACTION_MODEL=gpt-4o-mini
# 摘要专用 API 地址和密钥（可选，不设则复用主模型的 BASE_URL / API_KEY）
# BELLDANDY_COMPACTION_BASE_URL=https://api.openai.com/v1
# BELLDANDY_COMPACTION_API_KEY=sk-xxx

# TTS Configuration
# 启用语音模式（服务端自动将 Agent 回复转为语音，true/false，默认 false）
BELLDANDY_TTS_ENABLED=false
# TTS 提供商: dashscope | edge (free) | openai
BELLDANDY_TTS_PROVIDER="edge"
# 语音 ID: DashScope: Cherry | Edge: zh-CN-XiaoxiaoNeural | OpenAI: alloy
BELLDANDY_TTS_VOICE="zh-CN-XiaoxiaoNeural"
